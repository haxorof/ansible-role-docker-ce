---
- name: Set distribution facts
  set_fact:
    _docker_os_dist: "{{ ansible_distribution }}"
    _docker_os_dist_release: "{{ ansible_distribution_release }}"
    _docker_os_dist_major_version: "{{ ansible_distribution_major_version }}"
    _docker_os_dist_check: yes
  tags: ["docker-ce","facts"]

- name: Reinterpret distribution facts for Linux Mint 18
  set_fact:
    _docker_os_dist: "Ubuntu"
    _docker_os_dist_release: "xenial"
    _docker_os_dist_major_version: "16"
  when:
    _docker_os_dist == "Linux Mint" and
    _docker_os_dist_major_version == "18"

- include: checks.yml
  tags: ["docker-ce","facts"]

- include: distribution-check.yml
  when:
    docker_os_dist_check | bool
  tags: ["docker-ce","distribution-check"]

- include: setup-repository.yml
  tags: ["docker-ce","setup_repository"]

- include: kernel-3-mount-fixes.yml
  when: ansible_kernel | version_compare('4', '<')
  tags: ["docker-ce","kernel-3-mount-fixes"]

- include: setup-audit.yml
  tags: ["docker-ce","setup-audit"]

- include: remove-pre-docker-ce.yml
  when: docker_remove_pre_ce | bool
  tags: ["docker-ce","remove-pre-docker-ce"]

- include: install-docker.yml
  tags: ["docker-ce","install-docker"]

- include: configure-docker.yml
  tags: ["docker-ce","configure-docker"]
